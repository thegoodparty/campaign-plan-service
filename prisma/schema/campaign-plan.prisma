enum PlanStatus {
    queued
    running
    completed
    failed
}

model CampaignPlan {
    id                  String      @id @default(uuid(7)) @db.Uuid
    campaignId          Int         @map("campaign_id")
    version             Int
    status              PlanStatus  @default(queued)
    idempotencyKey      String      @unique @map("idempotency_key")
    model               String
    planJson            Json        @map("plan_json")
    costJson            Json?       @map("cost_json")
    sourceReason        String?     @map("source_reason")
    createdAt           DateTime    @default(now()) @db.Timestamptz(6)  @map("created_at")
    updatedAt           DateTime    @updatedAt      @db.Timestamptz(6)  @map("updated_at") 
    completedAt         DateTime?                   @db.Timestamptz(6)  @map("completed_at")
    errorMessage        String?     @map("error_message")
    tasks               CampaignPlanTask[]

    @@index([campaignId, version(sort: Desc)])
    @@index([campaignId, status])
    @@map("campaign_plans")
}